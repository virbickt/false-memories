<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>False memories and quasi-memories are memories</title>
    <!-- Load the base jspsych script and the jspsych-based plugins -->
    <script src="../../jspsych/jspsych.js"></script>
    <script src="../../jspsych/plugins/jspsych-instructions.js"></script>
    <script src="../../jspsych/plugins/jspsych-html-button-response.js"></script>
    <script src="../../jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="../../jspsych/plugins/jspsych-survey-likert.js"></script>
    <link href="../../jspsych/css/jspsych.css" rel="stylesheet" type="text/css">

    <style>
      .jspsych-btn-new {
        display: inline-block;
        width: 100%;
        max-width: 600px;
        margin-top: 30px;
        height: 100px;
        font-size: 15px;
        font-weight: 400;
        font-family: 'Open Sans', 'Arial', sans-serif;
        cursor: pointer;
        border-radius: 4px;
        line-height: 1.4;
        color: #333;
        background-color: #fff;
        border-color: #ccc;
        background-image: none;
        border: 1px solid black;
      }

      .jspsych-btn-new:hover {
        background-color: #ddd;
        border-color: #aaa;
      }
    </style>
  </head>

  <body>
  </body>
  <script>
  /* Initialize the variables that are not trial-specific. Putting all the global variables in front irrespective of the trial they are used for would have hurted the readability of the code. Thus, trial specific variables are initialized before the code block for each study. */
  var my_timeline = [];
  var count = 0;
  var proportion_complete;

 /* Welcome page. Refers to the paper on which the experiment is based. Also the point system is introduced. */
  var welcome = {
    type: 'instructions',
    pages: [
      'Welcome to the experiment, based on 2020 paper by V.Dranseika named "False memories and quasi-memories are memories."',
      'We are going to give you some scenarios to read, and ask your opinions on them. Points will be rewarded for the completion of each of the scenario that will be presented to you. Complete all scenarios to collect the maximum number of points.',
    ],
    show_clickable_nav: true,
    on_finish: function(){
        jsPsych.setProgressBar(0.00);
    }
  };

/* The following is responsible for "signposting" so that the participant is not taken to the trial immediately after answering the question. This particular trial is run before the first conditional block is evaluated. */
var pre_then = {
  type: 'instructions',
  pages: ['In that case, please consider the following scenario.'],
  show_clickable_nav: true,
}

/* Study 1: Quasi-memories and artificial memories */
/* Part 1: Declaring global variables for the options and scales used in the study. */

  var scale_1 = [
    'Strongly Disagree',
    'Disagree',
    'Neutral',
    'Agree',
    'Strongly Agree',
  ];

  var scale_2 = numberRange(1, 8);

  var yes_no_options = ["Yes", "No"];

  function numberRange(start, end) {
    return new Array(end - start).fill().map((d, i) => i + start);
  }

  function capitalize(str) {
    return str[0].toUpperCase() + str.substring(1);
  }

/* Part 2: The scenario-specific placeholders to plug in to the vignette template are initialized */
  var quasi = {
    Q1: 'to install human memories',
    Q2: 'other people’s',
    Q3: 'memories of other people',

    Q4: 'other people’s',
    Q5: '',
    6: 'the transferred',
  };

  var artificial = {
    Q1: 'to create artificial memories and to install such memories',
    Q2: 'artificial',
    Q3: 'artificial memories',

    Q4: 'artificial',
    Q5: '',
    Q6: 'the transferred',
  };

  var veridical = {
    Q1: 'to install human memories',
    Q2: 'other people’s',
    Q3: 'memories of other people',

    Q4: 'other people’s',
    Q5: `[Not all his memories,
                however, are transferred memories of other people. Some of his memories
                are from the period before memory transfer.]`,
    Q6: 'such original',
  };

/* This is the trial that preceeds the first conditional block (hence the name 'pre_if_trial'). The conditional blocks runs depending on the answer to the question presented in the trial.*/
  var pre_if_trial = {
    type: 'html-button-response',
    stimulus: '<p>Before we begin, let\'s break the ice. Say, do you enjoy science fiction?</p>',
    choices: yes_no_options,
    on_finish: function(data){
      scifi_response = yes_no_options[data.response];
      jsPsych.setProgressBar(0.00);
    }
  }

/* Second conditional block. Runs the signposting trial 'pre_then' regardless of how is the conditional evaluated (hence the disjunction in the conditional). */
  var if_node_2 = {
      timeline: [pre_then],
      conditional_function: function(){
          // get the data from the previous trial,
          // and check which key was pressed
          if(scifi_response === "No" || scifi_response === "Yes"){
              return true;
          } else {
              return false;
          }
      }
  }

  var p1_options = [quasi, artificial, veridical];
  var p1_shuffled = jsPsych.randomization.shuffle(p1_options);

  /*Part 3: The vignettes which are to be filled by scenario-specific placeholders are initialized. The vignettes are presented inside a single trial. The text for each vignette has been declared separately and then put inside a list that is set as the value of pages parameter.*/
  quasi_and_artificial_text_1 = `
      <p>
        Imagine that it is now the year 2086 and scientists have invented a
        technology that allows one ${p1_shuffled[0]['Q1']} into
        biological storage devices created for this purpose. This technology also
        allows one to transfer such memories into the brains of other people. A
        person, into whose brain such ${p1_shuffled[0]['Q2']} memories are transferred, cannot distinguish such transferred memories
        from their own memories. Also, no available technologies can distinguish
        such memories from others. This technology at the moment is experimental
        and secret, but it is already sometimes used as an educational tool, since it
        provides an easy way to transfer knowledge that was memorized by another
        person. It is also sometimes used as a means to improve psychological wellbeing
        by transferring pleasant ${p1_shuffled[0]['Q3']}
      </p>
      `;

  quasi_and_artificial_text_2 = `
      <p>
        Imagine that Albertas is a teenager who had a lot of ${p1_shuffled[0]['Q4']}
        memories transferred into his brain in his
        childhood. Albertas does not know and has no reason whatsoever to suspect
        that such memory transfer was performed on him. ${p1_shuffled[0]['Q5']}
        One of ${p1_shuffled[0]['Q6']} memories is about tasting
        rowan-berries in childhood. When someone asks Albertas whether he has
        ever tasted rowan-berries, Albertas replies with confidence: “Yes, I clearly
        remember eating rowan-berries when I was a child.”
      </p>
      `;

  var quasi_and_artificial = {
    type: 'instructions',
    pages: [quasi_and_artificial_text_1, quasi_and_artificial_text_2],
    show_clickable_nav: true,
  };

  /* Part 4: Timeline variable for the claims regarding remembering/knowing is inicialized. The procedure consist in a single trial
  with set parameters such as type of the survey and labels that is being repeated twice with each of the prompts that are declared at the beginning.
  Here the progress bar gets updated for the first time in the survey if the participant responded with "Yes" to "Like science fiction question?".
  */
  prompts = [
    'Do you agree that Albertas <b>remembers</b> that he has tasted rowan-berries when he was a child?',
    'Do you agree that Albertas <b>knows</b> that he has tasted rowan-berries when he was a child?',
  ];

  var quasi_and_artificial_questions = {
    timeline: [
        {
            type: 'survey-likert',
            questions: [{ prompt: jsPsych.timelineVariable('prompt'), labels: scale_1 }]
        }
    ],
    timeline_variables: [
        { prompt: 'Do you agree that Albertas <b>remembers</b> that he has tasted rowan-berries when he was a child?' },
        { prompt: 'Do you agree that Albertas <b>knows</b> that he has tasted rowan-berries when he was a child?' }
    ],
    randomize_order: true,
    on_finish: function(){
        jsPsych.setProgressBar(0.22);
        proportion_complete = jsPsych.getProgressBarCompleted();
  }};

  /*The following trial is as much an instance of signposting as much it is a part of the point system.
  This particular trial is only run as part of the series of trials that are run when participant responds with "Yes"
 to the SF question. It informs the participant of the number of points collected at that point.  */

  var milestone_2 = {
    type: 'instructions',
    pages: function(){
      return ['Well done! You have now ' + proportion_complete.toFixed(2)*10000 + ' points! Click \'Next\' and proceed to the next study to collect more!']},
    show_clickable_nav: true
  };

/* Second conditional block. Depending on the answer the question regarding preference toward science fiction, the series of science-fiction based trials are run that have been previously initialized.
  If the participant responds with "No", she is takan to the second study directly.
*/
  var if_node = {
      timeline: [if_node_2, quasi_and_artificial, quasi_and_artificial_questions, milestone_2],
      conditional_function: function(){
          if(scifi_response === "Yes"){
              return true;
          } else {
              return false;
          }
      }
  }

  /* Study 2: Dream memories */
  /* Part 1: Declaring global variables placeholders to be used to plug in the vignette template. These are shuffled and go through a conditional block which adds "ago" where needed so the resulting vignettes make sense gramatically. */
  var half_year = 'six months';
  var ten_years = 'ten years';
  var yesterday = 'yesterday';

  var p2_scenarios = [half_year, ten_years, yesterday];
  var p2_scenarios_shuffled = jsPsych.randomization.shuffle(p2_scenarios);

  if (
    p2_scenarios_shuffled[0] === half_year ||
    p2_scenarios_shuffled[0] === ten_years
  ) {
    p2_scenarios_shuffled[0] += ' ago';
  }

  /*Part 2: The vignettes which are to be filled by scenario-specific placeholders are initialized. Just like in the first study, vignettes sit inside a single trial while the text for each vignette is declared separately and is then placed inside a list that is set as the value of pages parameter.*/
  dream_memories_text_1 = `
      <p>
        ${capitalize(p2_scenarios_shuffled[0])} Ona was attending Algis’ twentieth
        birthday party. Thinking of that party, Ona has a vivid image in her mind of Regina
        inadvertently spilling red wine all over Jonas, followed by an image of Regina’s
        horrified expression at the mishap, and of Jonas sitting on the grass by the drinks
        table, completely drenched.
      </p>
      `;

  dream_memories_text_2 = `
      <p>
        However, no such event in fact occurred during Algis’ birthday party. Instead, what
        happened was just that Ona, very excited about the party, on the same night had a
        dream of Jonas having wine spilled all over him, and she came to believe that this
        event occurred, not in her dream, but in reality.
      </p>
      `;

  dream_memories_text_3 = `
      <p>
        When today a friend asked Ona whether she attended Algis’ twentieth birthday party
        ${p2_scenarios_shuffled[0]}, Ona replied: “Yes, I attended Algis’
        twentieth birthday party. Jonas was also there. I remember him having wine spilled all
        over him.”
      </p>
      `;

  var dream_memories = {
    type: 'instructions',
    pages: [dream_memories_text_1, dream_memories_text_2, dream_memories_text_3],
    show_clickable_nav: true,
  };

/*Part 3. Likert scale is used to have the participant is asked to express his agreement with the given claim that is based on the vignettes presented in the previous trial.*/
  var dm_prompt = `How much do you agree with the claim "Ona has a memory of Jonas having wine spilled all over him during a party"`;

  var dream_memories_q1 = {
    type: 'survey-likert',
    questions: [{ prompt: dm_prompt, labels: scale_2 }],
    on_finish: function(){
        jsPsych.setProgressBar(0.80);
    }
  };

/*Part 4. The following returns point system-related messages conditional on the answer the participant gave to the SF question. If the participant said "Yes" (which means that he had gone through the science-fiction based scenario, the points for the current study are added to the points he was awarded for finishing the science fiction scenario. If the participant said "No", she is rewarded with a number of points that is equivalent to the number of points she would have been awarded if she had proceeded with science fiction scenario. )*/
  var milestone_1 = {
    type: 'instructions',
    pages: function(){
        if(scifi_response === "Yes"){
          return ['Another ' + (jsPsych.getProgressBarCompleted().toFixed(2)*10000 - proportion_complete.toFixed(2)*10000) + ' points! You now have ' + ((jsPsych.getProgressBarCompleted().toFixed(2)*10000 - proportion_complete.toFixed(2)*10000) + proportion_complete.toFixed(2)*10000) + ' points!'];
        } else {
          return ['Well done! You have now ' + jsPsych.getProgressBarCompleted().toFixed(2)*10000 + ' points! Click \'Next\' and proceed to the next study to collect more!'];
        }
      },
      show_clickable_nav: true
  };


  // Study 3: The following trials implement the idea to allow the participant to indicate his agreement with one of the given claims. That is meant to supplement the judgmenet the participant delivered on first and second studies. Given the length, the claims are again declared separately to be lated used inside a list.
  options_qa = [
    `Even though Albertas hadn’t tasted rowan-berries when he was a child, he has a
                       memory of tasting rowan-berries`,
    `Albertas does not have a memory of tasting rowan-berries. He simply has an
                       experience like the experience of someone who has such memory`,
  ];

  options_dm = [
    `Ona has a memory of Jonas having wine spilled all over him during a party, even
                       though no such event in fact happened`,
    `Ona does not have a memory of Jonas having wine spilled all over him during a
                        party. She simply has an experience like the experience of someone who has a
                        memory of such event.`,
  ];


// timeline variable
  var elaborate_on_qa = {
    type: 'html-button-response',
    stimulus:
      'Which of the following two descriptions is more suitable to describe this situation?',
    choices: options_qa,
    button_html:
      '<button class="jspsych-btn-new" width="50" height="200">%choice%</button>',
  };

  var elaborate_on_dm = {
    type: 'html-button-response',
    stimulus:
      'Which of the following two descriptions is more suitable to describe this situation?',
    choices: options_dm,
    button_html: '<button class="jspsych-btn-new">%choice%</button>',
  };

  /* Study 4: Memories, money and gunes*/
  /* Part 1: Declare the global variables which in these case are the prompts (shuffled) to be used in the timeline variable*/

  var fakes_options = [
    [
      'A false memory is still a memory.',
      'A fake gun is still a gun.',
      'False money is still money.',
    ],
    [
      'A false memory is not a memory.',
      'A fake gun is not a gun.',
      'A fake gun is not a gun.',
    ],
  ];
  var fakes_options_shuffled = jsPsych.randomization.shuffle(fakes_options);

  /* Declare timeline variable for the study. The procedure consists in a single trial with with set parameters such as type of the survey and labels that is being repeated thrice with each of the prompts. The list of prompts selected using index 0 depends on the result on shuffling.
  In addition, the progress bar is set to full.
  */

  var falsities = {
    timeline: [
        {
            type: 'survey-likert',
            questions: [{ prompt: jsPsych.timelineVariable('prompt'), labels: scale_2 }]
        }
    ],
    timeline_variables: [
        { prompt: fakes_options_shuffled[0][0] },
        { prompt: fakes_options_shuffled[0][1] },
        { prompt: fakes_options_shuffled[0][2] },
    ],
    randomize_order: true,
    on_finish: function(){
        jsPsych.setProgressBar(1.00);
        proportion_complete = jsPsych.getProgressBarCompleted();
  }};

/* Final trial of the experiment which is meant to thank the participant and inform her about the number of points she collected.*/
  var conclude_survey = {
    type: 'instructions',
    pages: function(){
          return ['Congratulations! You have collected '+((jsPsych.getProgressBarCompleted().toFixed(2)*10000 - proportion_complete.toFixed(2)*10000) + proportion_complete.toFixed(2)*10000)
+' of points in total and finished the survey. Thank you for the participation!'];
      }
    };

  // my_timeline.push(welcome);
  // my_timeline.push(pre_if_trial);
  // my_timeline.push(if_node);
  // my_timeline.push(dream_memories);
  // my_timeline.push(dream_memories_q1);
  // my_timeline.push(elaborate_on_dm);
  // my_timeline.push(fakes);


  jsPsych.init({
    timeline: [welcome, pre_if_trial, if_node, if_node_2, dream_memories, dream_memories_q1, elaborate_on_dm, milestone_1, falsities, conclude_survey],
    show_progress_bar: true,
    // The progress is set manually so that so the participant is not awareded points on each trial.
    auto_update_progress_bar: false,
    // The progress bar is renamed to give an impression that is tracks the number of points the participant collected so far.
    message_progress_bar: 'Points earned',
    on_interaction_data_update: function(data) {
    console.log(JSON.stringify(data))
    if (data["event"] === "blur") {
      count++;
    }
  }
  });

  </script>
</html>
