<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>False memories and quasi-memories are memories</title>
    <script src="./jspsych/jspsych.js"></script>
    <script src="./jspsych/plugins/jspsych-instructions.js"></script>
    <script src="./jspsych/plugins/jspsych-html-button-response.js"></script>
    <script src="./jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="./jspsych/plugins/jspsych-survey-likert.js"></script>
    <link href="./jspsych/css/jspsych.css" rel="stylesheet" type="text/css">

    <style>
      .jspsych-btn-new {
        display: inline-block;
        width: 100%;
        max-width: 600px;
        margin-top: 30px;
        height: 100px;
        font-size: 15px;
        font-weight: 400;
        font-family: 'Open Sans', 'Arial', sans-serif;
        cursor: pointer;
        border-radius: 4px;
        line-height: 1.4;
        color: #333;
        background-color: #fff;
        border-color: #ccc;
        background-image: none;
        border: 1px solid black;
      }

      .jspsych-btn-new:hover {
        background-color: #ddd;
        border-color: #aaa;
      }
    </style>
  </head>


  <body>
  </body>
  <script>
  var my_timeline = [];
  var count = 0;
  var proportion_complete;

  var quasi = {
    Q1: 'to install human memories',
    Q2: 'other people’s',
    Q3: 'memories of other people',

    Q4: 'other people’s',
    Q5: '',
    6: 'the transferred',
  };

  var artificial = {
    Q1: 'to create artificial memories and to install such memories',
    Q2: 'artificial',
    Q3: 'artificial memories',

    Q4: 'artificial',
    Q5: '',
    Q6: 'the transferred',
  };

  var veridical = {
    Q1: 'to install human memories',
    Q2: 'other people’s',
    Q3: 'memories of other people',

    Q4: 'other people’s',
    Q5: `[Not all his memories,
                however, are transferred memories of other people. Some of his memories
                are from the period before memory transfer.]`,
    Q6: 'such original',
  };

  var yes_no_options = ["Yes", "No"];
  var p1_options = [quasi, artificial, veridical];
  var p1_shuffled = jsPsych.randomization.shuffle(p1_options);

  var scale_1 = [
    'Strongly Disagree',
    'Disagree',
    'Neutral',
    'Agree',
    'Strongly Agree',
  ];

  var options_agree = ['A', 'B'];

  function numberRange(start, end) {
    return new Array(end - start).fill().map((d, i) => i + start);
  }

  function capitalize(str) {
    return str[0].toUpperCase() + str.substring(1);
  }

  var scale_2 = numberRange(1, 8);

  var welcome = {
    type: 'instructions',
    pages: [
      'Welcome to the experiment, based on 2020 paper by V.Dranseika named "False memories and quasi-memories are memories."',
      'We are going to give you some scenarios to read, and ask your opinions on them.',
    ],
    show_clickable_nav: true,
  };

  var pre_if_trial = {
    type: 'html-button-response',
    stimulus: 'Do you enjoy science fiction?',
    choices: yes_no_options,
    on_finish: function(data){
      scifi_response = yes_no_options[data.response];
    }
  }

  // STUDY NO 1: PART 1
  quasi_and_artificial_text_1 = `
      <p>
        Imagine that it is now the year 2086 and scientists have invented a
        technology that allows one ${p1_shuffled[0]['Q1']} into
        biological storage devices created for this purpose. This technology also
        allows one to transfer such memories into the brains of other people. A
        person, into whose brain such ${p1_shuffled[0]['Q2']} memories are transferred, cannot distinguish such transferred memories
        from their own memories. Also, no available technologies can distinguish
        such memories from others. This technology at the moment is experimental
        and secret, but it is already sometimes used as an educational tool, since it
        provides an easy way to transfer knowledge that was memorized by another
        person. It is also sometimes used as a means to improve psychological wellbeing
        by transferring pleasant ${p1_shuffled[0]['Q3']}
      </p>
      `;

  // STUDY NO 1: PART 2
  quasi_and_artificial_text_2 = `
      <p>
        Imagine that Albertas is a teenager who had a lot of ${p1_shuffled[0]['Q4']}
        memories transferred into his brain in his
        childhood. Albertas does not know and has no reason whatsoever to suspect
        that such memory transfer was performed on him. ${p1_shuffled[0]['Q5']}
        One of ${p1_shuffled[0]['Q6']} memories is about tasting
        rowan-berries in childhood. When someone asks Albertas whether he has
        ever tasted rowan-berries, Albertas replies with confidence: “Yes, I clearly
        remember eating rowan-berries when I was a child.”
      </p>
      `;

  var quasi_and_artificial = {
    type: 'instructions',
    pages: [quasi_and_artificial_text_1, quasi_and_artificial_text_2],
    show_clickable_nav: true,
  };

  // timeline variable
  prompts = [
    'Do you agree that Albertas <b>remembers</b> that he has tasted rowan-berries when he was a child?',
    'Do you agree that Albertas <b>knows</b> that he has tasted rowan-berries when he was a child?',
  ];

  var quasi_and_artificial_questions = {
    timeline: [
        {
            type: 'survey-likert',
            questions: [{ prompt: jsPsych.timelineVariable('prompt'), labels: scale_1 }]
        }
    ],
    timeline_variables: [
        { prompt: 'Do you agree that Albertas <b>remembers</b> that he has tasted rowan-berries when he was a child?' },
        { prompt: 'Do you agree that Albertas <b>knows</b> that he has tasted rowan-berries when he was a child?' }
    ],
    randomize_order: true,
    on_finish: function(){
        proportion_complete = jsPsych.getProgressBarCompleted();
  }};

  var milestone_2 = {
    type: 'instructions',
    pages: function(){
      return ['Well done! You have now ' + proportion_complete.toFixed(2)*10000 + ' points! Click \'Next\' and proceed to the next study to collect more!']},
    show_clickable_nav: true
  };

  var if_node = {
      timeline: [quasi_and_artificial, quasi_and_artificial_questions, milestone_2],
      conditional_function: function(){
          // get the data from the previous trial,
          // and check which key was pressed
          if(scifi_response === "Yes"){
              return true;
          } else {
              return false;
          }
      }
  }

  // STUDY 2
  var half_year = 'six months';
  var ten_years = 'ten years';
  var yesterday = 'yesterday';

  var p2_scenarios = [half_year, ten_years, yesterday];
  var p2_scenarios_shuffled = jsPsych.randomization.shuffle(p2_scenarios);

  if (
    p2_scenarios_shuffled[0] === half_year ||
    p2_scenarios_shuffled[0] === ten_years
  ) {
    p2_scenarios_shuffled[0] += ' ago';
  }

  dream_memories_text_1 = `
      <p>
        ${capitalize(p2_scenarios_shuffled[0])} Ona was attending Algis’ twentieth
        birthday party. Thinking of that party, Ona has a vivid image in her mind of Regina
        inadvertently spilling red wine all over Jonas, followed by an image of Regina’s
        horrified expression at the mishap, and of Jonas sitting on the grass by the drinks
        table, completely drenched.
      </p>
      `;

  dream_memories_text_2 = `
      <p>
        However, no such event in fact occurred during Algis’ birthday party. Instead, what
        happened was just that Ona, very excited about the party, on the same night had a
        dream of Jonas having wine spilled all over him, and she came to believe that this
        event occurred, not in her dream, but in reality.
      </p>
      `;

  dream_memories_text_3 = `
      <p>
        When today a friend asked Ona whether she attended Algis’ twentieth birthday party
        ${p2_scenarios_shuffled[0]}, Ona replied: “Yes, I attended Algis’
        twentieth birthday party. Jonas was also there. I remember him having wine spilled all
        over him.”
      </p>
      `;

  var dream_memories = {
    type: 'instructions',
    pages: [dream_memories_text_1, dream_memories_text_2, dream_memories_text_3],
    show_clickable_nav: true,
  };

  var dm_prompt = `How much do you agree with the claim "Ona has a memory of Jonas having wine spilled all over him during a party"`;

  var dream_memories_q1 = {
    type: 'survey-likert',
    questions: [{ prompt: dm_prompt, labels: scale_2 }],
  };

  var milestone_1 = {
    type: 'instructions',
    pages: function(){
        if(scifi_response === "Yes"){
          return ['Another ' + (jsPsych.getProgressBarCompleted().toFixed(2)*10000 - proportion_complete) + ' points!'];
        } else {
          return ['Well done! You have now ' + jsPsych.getProgressBarCompleted().toFixed(2)*10000 + ' points! Click \'Next\' and proceed to the next study to collect more!'];
        }
      },
      show_clickable_nav: true
  };

  var descriptions = [
    `Even though Albertas hadn’t tasted rowan-berries when he was a child, he has a
      memory of tasting rowan-berries`,
    `Albertas does not have a memory of tasting rowan-berries. He simply has an
  experience like the experience of someone who has such memory`,
  ];

  // STUDY 3
  options_qa = [
    `Even though Albertas hadn’t tasted rowan-berries when he was a child, he has a
                       memory of tasting rowan-berries`,
    `Albertas does not have a memory of tasting rowan-berries. He simply has an
                       experience like the experience of someone who has such memory`,
  ];

  options_dm = [
    `Ona has a memory of Jonas having wine spilled all over him during a party, even
                       though no such event in fact happened`,
    `Ona does not have a memory of Jonas having wine spilled all over him during a
                        party. She simply has an experience like the experience of someone who has a
                        memory of such event.`,
  ];

  var elaborate_on_qa = {
    type: 'html-button-response',
    stimulus:
      'Which of the following two descriptions is more suitable to describe this situation?',
    choices: options_qa,
    button_html:
      '<button class="jspsych-btn-new" width="50" height="200">%choice%</button>',
  };

  var elaborate_on_dm = {
    type: 'html-button-response',
    stimulus:
      'Which of the following two descriptions is more suitable to describe this situation?',
    choices: options_dm,
    button_html: '<button class="jspsych-btn-new">%choice%</button>',
  };

  var fakes_options = [
    [
      'A false memory is still a memory.',
      'A fake gun is still a gun.',
      'False money is still money.',
    ],
    [
      'A false memory is not a memory.',
      'A fake gun is not a gun.',
      'A fake gun is not a gun.',
    ],
  ];
  var fakes_options_shuffled = jsPsych.randomization.shuffle(fakes_options);

  // STUDY 4
  var fakes = {
    type: 'survey-likert',
    questions: [
      { prompt: fakes_options_shuffled[0][0], labels: scale_2 },
      { prompt: fakes_options_shuffled[0][1], labels: scale_2 },
      { prompt: fakes_options_shuffled[0][2], labels: scale_2 },
    ],
    randomize_question_order: true,
  };

  // my_timeline.push(welcome);
  // my_timeline.push(pre_if_trial);
  // my_timeline.push(if_node);
  // my_timeline.push(dream_memories);
  // my_timeline.push(dream_memories_q1);
  // my_timeline.push(elaborate_on_dm);
  // my_timeline.push(fakes);

  jsPsych.init({
    timeline: [welcome, pre_if_trial, if_node, dream_memories, dream_memories_q1, elaborate_on_dm, milestone_1, fakes],
    show_progress_bar: true,
    message_progress_bar: 'Points earned',
    on_interaction_data_update: function(data) {
    console.log(JSON.stringify(data))
    if (data["event"] === "blur") {
      count++;
    }
  }
  });

  </script>
</html>
